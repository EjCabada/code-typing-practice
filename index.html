<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Typing Practice</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: rgb(53, 58, 67);
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100vh;
        margin: auto;
        color: white;
        max-width: 2000px;
      }

      h1 {
        font-size: 5em;
        letter-spacing: 3px;
        text-align: center;
      }
      #titlebar {
        position: static;
        width: 90%;
        margin: 5em 5em;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-content: space-between;
        align-items: center;
      }

      #statsbar {
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-content: space-between;
      }

      #container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-around;
        align-content: space-around;
        height: 100%;
        margin: 5em;
      }
      #stats,
      #stats2,
      #spacer {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 20px;
        max-width: 17em;
      }

      #stats2 {
        text-align: right;
        transition: color 0.3s ease-in-out; /* Add transition for smooth color change */
      }
      #maincontent {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #symbol {
        font-size: 5em;
        margin-bottom: 20px;
        font-weight: 700;
        text-shadow: rgb(0, 0, 0) 0px 4px 18px;
        transition: opacity 0.3s ease-in-out; /* Add transition for smooth fade */
      }
      input {
        font-size: 24px;
        padding: 35px;
        width: 200px;
        text-align: center;
        border-radius: 10px;
        border: none;
      }

      #inputBox {
        box-shadow: rgba(0, 0, 0, 0.733) 0px 4px 15px;
      }

      #inputBox2 {
        font-size: 18px;
        padding: 5px;
        width: 200px;
        text-align: center;
        border-radius: 10px;
        border: none;
      }

      #clearButton {
        font-size: 18px;
        padding: 5px;
        width: fit-content;
        text-align: center;
        border-radius: 10px;
        border: none;
      }

      #errorMessage {
        margin-top: 10px;
        color: rgb(255, 115, 115);
        font-size: 18px;
      }

      #mode {
        display: flex;
        flex-direction: row;
        justify-content: center;
      }

      button {
        margin-top: 20px;
        font-size: 18px;
        padding: 15px;
        margin: 20px 10px;
        border: none;
        border-radius: 13px;
        background-color: white;
      }
    </style>
  </head>
  <body>
    <div id="titlebar">
      <div id="statsbar">
        <div id="stats">Total Correct: 0</div>
        <div id="stats2">Right/Wrong Ratio (Last 20): 0%</div>
      </div>
      <h1>Coding Characters Practice</h1>
    </div>
    <div id="container">
      <div id="maincontent">
        <div id="symbol"></div>
        <input type="text" id="inputBox" placeholder="Type here" autofocus />
        <div id="errorMessage"></div>
      </div>
      <div>
        <input type="text" id="inputBox2" placeholder="practice" autofocus />
        <button id="clearButton">Clear</button>
      </div>
      <div id="mode">
        <button
          id="general"
          onclick="switchMode('general')"
          style="font-weight: 700"
        >
          General Mode
        </button>
        <button id="rightHand" onclick="switchMode('rightHand')">
          Right-Hand Mode
        </button>
        <button id="timedMode" onclick="toggleTimedMode()">
          Timed Mode (Off)
        </button>
      </div>
    </div>
    <footer><p>Created by EJ Cabada version 2.2 Â© 2024</p></footer>

    <script>
      const generalSymbols = '=+-_()*&&!@:"{}[]/?.';
      const generalHomeRow = "asdfjkl;";
      const rightHandSymbols = "()p_-=+[{]}\"';:?/";
      const rightHandHomeRow = "l;";

      let currentSetSymbols = generalSymbols;
      let currentSetHomeRow = generalHomeRow;

      let alternateFlag = true; // true = symbols, false = home row
      let correctCount = 0;
      let characterCount = 0;
      let currentIndex = 0;
      let last20Attempts = [];

      function getRandomCharacter(set) {
        const randomIndex = Math.floor(Math.random() * set.length);
        return set[randomIndex];
      }

      function updateSymbol() {
        const symbolDiv = document.getElementById("symbol");
        symbolDiv.style.opacity = 0; // Briefly hide the symbol

        setTimeout(() => {
          const setToUse = alternateFlag
            ? currentSetSymbols
            : currentSetHomeRow;
          currentIndex = getRandomCharacter(setToUse);
          symbolDiv.innerText = currentIndex;
          symbolDiv.style.opacity = 1; // Show the symbol again
          document.getElementById("inputBox").value = "";
          document.getElementById("errorMessage").innerText =
            "Feedback will appear here";
          document.getElementById("errorMessage").style.color = "white";
        }, 300); // Adjust timing as needed
      }

      function updateStats() {
        const correctAttempts = last20Attempts.filter(
          (attempt) => attempt === true
        ).length;
        const totalAttempts = last20Attempts.length;
        const ratio =
          totalAttempts > 0 ? (correctAttempts / totalAttempts) * 100 : 0;
        document.getElementById(
          "stats"
        ).innerText = `Total Correct: ${correctCount}`;
        // document.getElementById(
        //   "stats2"
        // ).innerText = `Right/Wrong Ratio (Last 20): ${ratio.toFixed(2)}%`;

        const stats2Div = document.getElementById("stats2");
        stats2Div.innerText = `Right/Wrong Ratio (Last 20): ${ratio.toFixed(
          2
        )}%`;

        // Change color based on ratio
        if (ratio == 0) {
          stats2Div.style.color = "rgb(256, 256, 256)";
        } else if (ratio < 60) {
          stats2Div.style.color = "rgb(255, 115, 115)";
        } else if (ratio >= 60 && ratio <= 80) {
          stats2Div.style.color = "rgb(255, 226, 110)";
        } else {
          stats2Div.style.color = "rgb(114, 237, 124)";
        }
      }

      function trackAttempt(success) {
        last20Attempts.push(success);
        if (last20Attempts.length > 20) {
          last20Attempts.shift(); // Keep only the last 20 attempts
        }
        updateStats();
      }

      document
        .getElementById("inputBox")
        .addEventListener("input", function () {
          const input = this.value;
          const currentSymbol = document.getElementById("symbol").innerText;

          if (input === currentSymbol) {
            correctCount++;
            characterCount++;
            trackAttempt(true);
            alternateFlag = !alternateFlag;
            this.style.backgroundColor = "rgb(114, 237, 124)"; // Flash green
            setTimeout(() => {
              this.style.backgroundColor = "white"; // Reset color
            }, 100); // Adjust timing as needed
            updateSymbol();
          } else {
            this.value = ""; // Clear input field on incorrect input
            document.getElementById(
              "errorMessage"
            ).innerText = `Input character was: ${input}`;
            document.getElementById("errorMessage").style.color =
              "rgb(255, 75, 75)";
            trackAttempt(false);
          }
        });

      function switchMode(mode) {
        resetStats(); // Reset stats on mode change
        if (mode === "general") {
          currentSetSymbols = generalSymbols;
          currentSetHomeRow = generalHomeRow;
          document.getElementById("rightHand").style.fontWeight = "400";
          document.getElementById("general").style.fontWeight = "700";
        } else if (mode === "rightHand") {
          currentSetSymbols = rightHandSymbols;
          currentSetHomeRow = rightHandHomeRow;
          document.getElementById("general").style.fontWeight = "400";
          document.getElementById("rightHand").style.fontWeight = "700";
        }
        updateSymbol(); // Start with the new mode
      }

      function resetStats() {
        correctCount = 0;
        characterCount = 0;
        last20Attempts = [];
        updateStats();
      }

      document
        .getElementById("clearButton")
        .addEventListener("click", function () {
          document.getElementById("inputBox2").value = "";
        });

      // Initialize with the first symbol
      updateSymbol();

      let timerInterval;
      let timeLeft = 60;
      let timedMode = false;
      let timerStarted = false; // Flag to check if the timer has started

      function toggleTimedMode() {
        timedMode = !timedMode;
        const timedModeButton = document.getElementById("timedMode");

        if (timedMode) {
          timedModeButton.innerText = "Timed Mode (60)";
          resetStats(); // Reset stats when starting timed mode
          timeLeft = 60; // Reset time left
          timerStarted = false; // Reset timerStarted flag
        } else {
          timedModeButton.innerText = "Timed Mode (Off)";
          clearInterval(timerInterval); // Stop the timer
          timeLeft = 60; // Reset time left
          timerStarted = false; // Reset timerStarted flag
        }
      }

      function startTimer() {
        timerInterval = setInterval(() => {
          timeLeft--;
          document.getElementById(
            "timedMode"
          ).innerText = `Timed Mode (${timeLeft})`;

          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert("Time's up!");
            toggleTimedMode(); // Turn off timed mode
          }
        }, 1000);
      }

      document
        .getElementById("inputBox")
        .addEventListener("input", function () {
          // ... (your existing input event listener code) ...

          if (timedMode && !timerStarted) {
            startTimer();
            timerStarted = true;
          }
        });
    </script>
  </body>
</html>
